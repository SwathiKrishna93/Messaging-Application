<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->
    <title>Group Chat</title>
    <!-- BOOTSTRAP CORE STYLE CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONT AWESOME  CSS -->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLE CSS -->
    <link href="assets/css/style.css" rel="stylesheet" />
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>

ï»¿

#contentWrap{

   display:none;
   background-color:black;
			
 }


body {
   font-family:Verdana;
}
.pad-top {
    padding-top:30px;
}
.pad-bottom {
     padding-bottom:30px;
}
/*======================================
    CHAT BOX STYLES
======================================= */

.hr-clas {
    border-top: 1px solid #A12EB3;
}

.chat-box-main {
    height:500px;
    max-height:500px;
    overflow:auto;
}
.chat-box-div {
    border:2px solid black;
    border-bottom:2px solid black;
} 
.chat-box-head {
    padding: 10px 15px;
border-bottom: 2px solid black;
background-color: #342D7E;
color: #fff;
text-align: center;

}

.chat-box-left {
    width: 100%;
    height: auto;
    padding: 15px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    position: relative;
    border: 1px solid #C5C5C5;
    font-size:12px;
}
.chat-box-left:after {
    top: 100%;
    left: 10%;
    border: solid transparent;
    content: " ";
    position: absolute;
    border-top-color: #C5C5C5;
    border-width: 15px;
    margin-left: -15px;
}

.chat-box-name-left {
    margin-top: 30px;
    margin-left: 60px;
    text-align:left;
    color:#049E64;
}
    .chat-box-name-left img {
        max-width:40px;
        border: 2px solid #049E64;
    }

    .chat-box-right {
    width:200px;
    height: auto;
    padding: 15px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    position: relative;
    border: 1px solid #C5C5C5;
    font-size:12px;
    float:right;
}
.chat-box-right:after {
    top: 100%;
    right: 10%;
    border: solid transparent;
    content: " ";
    position: absolute;
    border-top-color: #C5C5C5;
    border-width: 15px;
    margin-left: -15px;
}

.chat-box-name-right {
    color: #354EA0;
    margin-top: 12px;
    margin-right: 60px;
    text-align:right;
    float:right;
}
.err {
            color: red;
            position: absolute;
            right: 30px;
            padding: 5px;
            margin-left: 15px;

        }
.chat-box-name-right img {
        max-width:40px;
        border: 2px solid #354EA0;
    }
.chat-box-footer {
    background-color: #D8D8D8;
padding: 5px;

}
/*======================================
    CHAT BOX ONLINE STYLES
======================================= */


.hr-clas-low {
    border-top: 1px solid #C5C5C5;
}

.chat-box-online {
     height:580px;
     max-height:580px;
    overflow:auto;
}
.chat-box-online-div {
    border:2px solid black;
    border-bottom:2px solid black;
} 

.chat-box-online-head {
    padding: 10px 15px;
border-bottom: 2px solid black;
background-color: #342D7E;
color: #fff;
text-align: center;

}

.chat-box-online-left {
    margin-left: 10px;
    text-align:left;
    color:black;
}
    .chat-box-online-left img {
        max-width:30px;
        border:1px solid #049E64;
        margin-bottom:10px;
    }
    .chat-box-online-right {
    margin-right: 10px;
   text-align:right;
    color:#354EA0;
    background-color:gray;
}
    .chat-box-online-right img {
       max-width:30px;
        border:1px solid #354EA0;
        margin-bottom:10px;
        
    }

    /*======================================
  NEW  CHAT  STYLES
======================================= */

.chat-box-new {
     height:580px;
     max-height:580px;
    overflow:auto;
}
.chat-box-new-div {
    border:2px solid black;
    border-bottom:2px solid black;
} 
.abc{
    position: absolute;
    top:600px;
    left: 500px;
    text-align: center;
}
.chat-box-new-head {
    padding: 10px 15px;
border-bottom: 2px solid black;
background-color: #342D7E;
color: #fff;
text-align: center;

}

#nickWrap{
background-color:;

}
.heading{
margin-top:250px;
font-size:35px;
text-align:center;
padding-bottom:200px;
}

#form{
font-size:20px;
}
#setNick{
font-size:25px;
}

#nickname{
width:50%;
margin-left:22%;
}
</style>



<div id="nickWrap">

<div class="heading">
CS252 PROJECT
<br>
 (Group Chat-Application)
</div>

		<div id="form">
			<p align="center">Enter a username:</p>
            <br></br>
			<p id="nickError"></p>
			<form id="setNick">
				<input size="50px" id="nickname"></input>
				<input type="submit", value="Submit"></input>
			</form>
		</div>
	</div>




<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="socket.io/socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	
	<script type="text/javascript">
		
		jQuery(function($){
			
			var socket = io.connect();
			window.switchRoom = function(room){
				socket.emit('switchRoom', room);
   			}
			var $nickForm = $('#setNick');
			var $nickError = $('#nickError');
			var $nickBox = $('#nickname');
			var $users = $('#users');
			var $messageForm = $('#send-message');
			var $messageBox = $('#message');
			var $chat = $('#chat');
			var $rooms = $('#rooms');
            $("#datasend").val("Send");
			$nickForm.submit(function(e){
				e.preventDefault();
				socket.emit('new user', $nickBox.val(), function(data){
					if(data){
						$('#nickWrap').hide();
						$('#contentWrap').show();
					}
					else{
						$nickError.html('<span class="abc" style=text-align:center;>That username is already taken! Try again!</span>');
					}
				});
				$nickBox.val('');
			});

			socket.on('usernames',function(data){
				var html ='';
				for (var i = 0; i < data.length  ; i++) {
					html += '<br><b>'+ data[i] + '</b><br>';
				}
				$users.html(html);
			});

			
			socket.on('updaterooms', function(rooms, current_room) {
			        $('#rooms').empty();
			        $.each(rooms, function(key, value) {
			            if(value == current_room){
			                $('#rooms').append('<div><br>' + value + '</br><br></div>');
			            }
			            else {
			                $('#rooms').append('<div><br><a href="#" onclick="switchRoom(\''+value+'\');">' + value + '</a></br><br></div>');
			            }
			            //alert(value);
			        });
			        
			    });

			// function switchRoom(room){
				
			//         socket.emit('switchRoom', room);
   // 			}
   			// socket.on('updateUsersRoom',function(room){
   			// 	var clients = io.sockets.clients(room);
   			// 	for(var i in clients)
   			// 	{

   			// 	}
   			// });
            window.onbeforeunload = function() {
                    return "Do you really want to reload? You will be logged out!";
                }
			socket.on('updateroomusers', function(roomusers) {
				$("#roomUsers").empty();
				$.each(roomusers, function (key, value) {
				$('#roomUsers').append(' <br>' +value+' <br>');
				});
			});

			$messageForm.submit(function(e){
				e.preventDefault();
				
				socket.emit('send message', $messageBox.val(),function(data){
						$chat.append('<br><span class="err"><b> Error :</b>' + data + "</span><br/><br>");
					});
				$messageBox.val('');
				
				
			});

		 /*	socket.on('load old messages', function(docs){
				for(var i = docs.length -1 ; i>=0; i--){
					displayMsg(docs[i]);
				}

			}); */
			// //var ctx = document.getElementById('canvas').getContext('2d');

			// socket.on("image", function(info) {
			// 	  if (info.image) {
			// 	    var img = new Image();
			// 	    img.src = 'data:image/jpeg;base64,' + image.buffer;
			// 	    ctx.drawImage(img, 0, 0);
			// 	  }
			// });

			socket.on('new message',function(data){
				if(data.nick== 'SERVER')
					{
						$chat.append('<br><b>' + data.nick + ':</b>' + data.msg + "</br><br>");
					}
				else {
					displayMsg(data);
				}
			});
			socket.on('own message',function(data){
				 $chat.append('<br><span class="chat-box-right" style="width:100%;background-color:#B19CD9;">'+ data.msg + "</span><br/><br>"); 
                                 $chat.append('<br><span class="chat-box-name-right">'+ data.nick + "</span><br/><br>");
                                 $chat.append( '<hr <span="hr-clas" />');
			});
			function displayMsg(data){
				$chat.append('<br><span class="chat-box-left" style="width:100%;background-color:#ADD8E6;">'+ data.msg + "</span><br/><br>"); 
                                $chat.append('<br><span class="chat-box-name-left" style="margin-left:0px;" >'+ data.nick + "</span><br/><br>");
                                $chat.append( '<hr <span="hr-clas" />');
			
			}
			socket.on('whisper', function(data){
				$chat.append('<br><span class="chat-box-left" style="width:100%;background-color:#DDA0DD;">'+ data.msg + "</span><br/><br>"); 
                                $chat.append('<br><span class="chat-box-name-left">'+ data.nick + "</span><br/><br>");
                                $chat.append( '<hr <span="hr-clas" />');

			});
			socket.on('own whisper', function(data){
				$chat.append('<br><span class="chat-box-right" style="width:100%;background-color:#99C68E;color:white;">'+ data.msg + "</span><br/><br>"); 
                                $chat.append('<br><span class="chat-box-name-right">'+ data.nick + "</span><br/><br>");
                                $chat.append( '<hr <span="hr-clas" />');

			});
		});
	</script>




</head>
<body>




<div id="contentWrap" style="display: none;">

    <div class="container">
        <div class="row pad-top pad-bottom">


            <div class=" col-lg-6 col-md-6 col-sm-6">
                <div class="chat-box-div">
                    <div class="chat-box-head">
                        GROUP CHAT HISTORY
                    </div>
                    <div class="panel-body chat-box-main" id="chat">
                        
                       
                    </div>
                    <div class="chat-box-footer">
                       <div id="form">
				        <form id="send-message">
					       <input size="125" id="message" style="width:78%;height:50px;"></input>
					       <input type="submit", id= "datasend",value="Send", style="height:50px;width:18%;position:absolute; right:25px;"></input>
				        </form>
			         </div>
                   </div>

                </div>

            </div>


            <div class="col-lg-3 col-md-3 col-sm-3">
                <div class="chat-box-online-div">
                    <div class="chat-box-online-head">
                        ONLINE USERS
                    </div>
                    <div class="panel-body chat-box-online">

                        <div class="chat-box-online-left" style="text-align:center;" id="roomUsers">

                         
                          
                        </div>

                    </div>

                </div>

            </div>
            <div class="col-lg-3 col-md-3 col-sm-3">
                <div class="chat-box-new-div">
                    <div class="chat-box-new-head">
                        ROOMS
                    </div>
                    <div class="panel-body chat-box-new" style="text-align:center;" id="rooms">


                      
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

    <!-- USING SCRIPTS BELOW TO REDUCE THE LOAD TIME -->
    <!-- CORE JQUERY SCRIPTS FILE -->
    <script src="assets/js/jquery-1.11.1.js"></script>
    <!-- CORE BOOTSTRAP SCRIPTS  FILE -->
    <script src="assets/js/bootstrap.js"></script>
</body>

</html>
